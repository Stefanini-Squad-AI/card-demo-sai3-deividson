<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí≥ TRANSACTION - Transacciones - Gu√≠a de Desarrollo de User Stories</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
        }
        .header h1 {
            font-size: 2.4rem;
            margin-bottom: 0.3rem;
        }
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        h2 {
            color: #667eea;
            margin-bottom: 1.2rem;
            font-size: 1.8rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 0.5rem;
        }
        h3 {
            color: #5a67d8;
            margin: 1.4rem 0 0.8rem;
            font-size: 1.4rem;
        }
        h4 {
            color: #4c51bf;
            margin: 1rem 0 0.6rem;
            font-size: 1.1rem;
        }
        .overview ul {
            list-style: none;
            margin-left: 0;
        }
        .overview li {
            margin-bottom: 0.6rem;
            padding-left: 1.5rem;
            position: relative;
        }
        .overview li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }
        .us-template {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 1.5rem;
            border-radius: 4px;
            margin-bottom: 1.2rem;
        }
        .us-template strong {
            display: block;
            color: #667eea;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }
        .us-template p {
            margin-bottom: 0.6rem;
            font-style: italic;
        }
        .us-template ul {
            margin-left: 1rem;
            list-style-type: disc;
        }
        .us-template ul li {
            margin-bottom: 0.4rem;
            padding-left: 0;
        }
        .us-template ul li:before {
            display: none;
        }
        .complexity-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        .simple {
            background: #c6f6d5;
            color: #22543d;
        }
        .medium {
            background: #fef3c7;
            color: #7c2d12;
        }
        .complex {
            background: #fed7d7;
            color: #742a2a;
        }
        .component-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 1.4rem;
            margin: 1rem 0;
        }
        .component-card h4 {
            margin-top: 0;
            color: #667eea;
        }
        .component-card p {
            margin-bottom: 0.8rem;
        }
        .component-card ul {
            margin-left: 1.5rem;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
            line-height: 1.5;
        }
        .highlight {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 0.8rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            padding: 0.8rem;
            border-bottom: 1px solid #e2e8f0;
            text-align: left;
        }
        th {
            background: #f1f5f9;
            color: #667eea;
            font-weight: 700;
        }
        tr:hover {
            background: #f8fafc;
        }
        .back-link {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.2s;
            margin-top: 1rem;
        }
        .back-link:hover {
            background: #5a67d8;
        }
        code {
            background: #e2e8f0;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #4a5568;
        }
        .api-endpoint {
            background: #ebf8ff;
            border-left: 3px solid #3182ce;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .api-endpoint strong {
            color: #2c5282;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üí≥ TRANSACTION - Administraci√≥n de Transacciones</h1>
            <p>Gu√≠a t√©cnica completa para escribir User Stories del m√≥dulo de gesti√≥n de transacciones con tarjeta de cr√©dito.</p>
        </header>

        <section class="overview">
            <h2>üìã Vista General del Mdddulo</h2>
            <p><strong>Prop√≥sito:</strong> Permitir que operadores y administradores visualicen, registren, busquen y generen reportes de transacciones de tarjetas de cr√©dito, replicando las funcionalidades y teclas de funci√≥n de los programas legacy COBOL serie COTRNxx.</p>
            
            <p><strong>Contexto de Negocio:</strong> Este m√≥dulo es el n√∫cleo de las operaciones diarias de procesamiento de transacciones financieras. Incluye:</p>
            <ul>
                <li><strong>Listado paginado:</strong> Navegaci√≥n manual de transacciones con b√∫squeda por ID</li>
                <li><strong>Visualizaci√≥n detallada:</strong> Consulta de informaci√≥n completa de transacci√≥n individual</li>
                <li><strong>Registro de transacciones:</strong> Alta de nuevas operaciones con validaciones estrictas</li>
                <li><strong>Reporter√≠a:</strong> Generaci√≥n de informes mensuales, anuales y personalizados</li>
            </ul>

            <h3>üèóÔ∏è Arquitectura de Componentes</h3>
            
            <h4>üìÑ P√°ginas (Pages)</h4>
            <ul>
                <li><code>/app/pages/TransactionListPage.tsx</code> ‚Äì P√°gina contenedora del listado con manejo de notificaciones toast</li>
                <li><code>/app/pages/TransactionViewPage.tsx</code> ‚Äì P√°gina de visualizaci√≥n que extrae transactionId de la URL</li>
                <li><code>/app/pages/TransactionAddPage.tsx</code> ‚Äì P√°gina de registro de nuevas transacciones</li>
                <li><code>/app/pages/TransactionReportsPage.tsx</code> ‚Äì P√°gina de generaci√≥n de reportes</li>
            </ul>

            <h4>üß© Componentes (Screens)</h4>
            <ul>
                <li><code>/app/components/transaction/TransactionListScreen.tsx</code> ‚Äì Tabla paginada con b√∫squeda, selecci√≥n y navegaci√≥n F7/F8</li>
                <li><code>/app/components/transaction/TransactionViewScreen.tsx</code> ‚Äì Pantalla de detalle con informaci√≥n completa de transacci√≥n</li>
                <li><code>/app/components/transaction/TransactionAddScreen.tsx</code> ‚Äì Formulario de alta con validaciones y confirmaci√≥n</li>
                <li><code>/app/components/transaction/TransactionReportsScreen.tsx</code> ‚Äì Interfaz de selecci√≥n y configuraci√≥n de reportes</li>
                <li><code>/app/components/transaction/TransactionReportTable.tsx</code> ‚Äì Tabla de visualizaci√≥n de reportes generados</li>
            </ul>

            <h4>üé£ Hooks de L√≥gica de Negocio</h4>
            <ul>
                <li><code>/app/hooks/useTransactionList.ts</code> ‚Äì B√∫squeda, paginaci√≥n manual, selecci√≥n y validaciones de listado</li>
                <li><code>/app/hooks/useTransactionView.ts</code> ‚Äì B√∫squeda individual, limpiar pantalla y navegaci√≥n a listado</li>
                <li><code>/app/hooks/useTransactionAdd.ts</code> ‚Äì Validaciones de formulario, confirmaci√≥n y env√≠o de nueva transacci√≥n</li>
                <li><code>/app/hooks/useTransactionReports.ts</code> ‚Äì Generaci√≥n de reportes mensuales/anuales/personalizados y descarga</li>
            </ul>

            <h4>üìê Tipos TypeScript</h4>
            <ul>
                <li><code>/app/types/transactionList.ts</code> ‚Äì Interfaces para request/response de listado y paginaci√≥n</li>
                <li><code>/app/types/transactionView.ts</code> ‚Äì Interfaces para consulta individual con datos de comerciante</li>
                <li><code>/app/types/transactionAdd.ts</code> ‚Äì Interfaces para registro con validaciones de monto y fechas</li>
                <li><code>/app/types/transactionReports.ts</code> ‚Äì Interfaces para reportes con agrupaci√≥n por cuenta</li>
            </ul>

            <h4>üß™ Mocks MSW</h4>
            <ul>
                <li><code>/app/mocks/transactionListHandlers.ts</code> ‚Äì Mock de listado, paginaci√≥n siguiente/anterior</li>
                <li><code>/app/mocks/transactionViewHandlers.ts</code> ‚Äì Mock de b√∫squeda individual y limpiar pantalla</li>
                <li><code>/app/mocks/transactionAddHandlers.ts</code> ‚Äì Mock de registro con validaciones backend</li>
                <li><code>/app/mocks/transactionReportsHandlers.ts</code> ‚Äì Mock de generaci√≥n de reportes con datos sint√©ticos</li>
            </ul>
        </section>

        <section class="us-guide">
            <h2>üéØ Gu√≠a de Desarrollo de User Stories</h2>

            <h3>üìù Plantillas Espec√≠ficas de US por Funcionalidad</h3>
            
            <div class="us-template">
                <strong>US-TRANS-01: Listado y b√∫squeda de transacciones</strong>
                <p>Como <em>operador de tarjetas de cr√©dito</em>, quiero <em>ver el listado paginado de transacciones y buscar por ID espec√≠fico</em> para <em>localizar r√°pidamente operaciones y verificar detalles de montos y fechas</em>.</p>
                
                <p><strong>Criterios de Aceptaci√≥n:</strong></p>
                <ul>
                    <li>El listado inicial muestra 10 transacciones por p√°gina con ID, fecha (MM/DD/YY), descripci√≥n y monto</li>
                    <li>Campo de b√∫squeda acepta Transaction ID num√©rico (validaci√≥n: solo d√≠gitos, mensaje "Tran ID must be Numeric ...")</li>
                    <li>ENTER o bot√≥n "Search" dispara la b√∫squeda, actualizando el listado filtrado</li>
                    <li>Paginaci√≥n manual: F7 p√°gina anterior, F8 p√°gina siguiente</li>
                    <li>Validaci√≥n de l√≠mites: mensaje "You are already at the top of the page..." o "...bottom of the page..."</li>
                    <li>Selecci√≥n: campo dropdown por fila con opci√≥n 'S', presionar ENTER o √≠cono navega a /transactions/view/:id</li>
                    <li>F3 o ESC sale hacia /menu/main</li>
                    <li>Hook: <code>useTransactionList</code> con funciones handleSearch, handleNextPage, handlePreviousPage</li>
                </ul>
                
                <p><strong>Endpoints API:</strong></p>
                <div class="code-block">POST /transactions/list          // B√∫squeda inicial
POST /transactions/next-page      // P√°gina siguiente
POST /transactions/previous-page  // P√°gina anterior</div>
                
                <span class="complexity-badge simple">Simple (1-2 pts)</span>
            </div>

            <div class="us-template">
                <strong>US-TRANS-02: Visualizaci√≥n detallada de transacci√≥n</strong>
                <p>Como <em>analista de operaciones</em>, quiero <em>consultar el detalle completo de una transacci√≥n por su ID</em> para <em>revisar informaci√≥n del comerciante, montos, fechas y categor√≠as</em>.</p>
                
                <p><strong>Criterios de Aceptaci√≥n:</strong></p>
                <ul>
                    <li>Campo de b√∫squeda acepta Transaction ID, ENTER dispara consulta</li>
                    <li>Validaci√≥n: "Transaction ID cannot be empty..." si campo vac√≠o</li>
                    <li>Respuesta exitosa muestra: cardNumber, transactionTypeCode, categoryCode, source, amount (formato currency), description, originalTimestamp, processedTimestamp, merchantId, merchantName, merchantCity, merchantZip</li>
                    <li>Header info: currentDate, currentTime, programName ("COTRN01C"), transactionName ("CT01")</li>
                    <li>Bot√≥n "Clear Screen" (F4) limpia el formulario y resetea datos</li>
                    <li>Bot√≥n "Browse Transactions" (F8) navega a /transactions/list</li>
                    <li>F3 o ESC sale hacia /menu/main</li>
                    <li>Hook: <code>useTransactionView</code> con handleSearch, handleClearScreen, handleBrowseTransactions</li>
                    <li>Soporte para initialTransactionId desde URL params para carga autom√°tica</li>
                </ul>
                
                <p><strong>Endpoints API:</strong></p>
                <div class="code-block">GET /transaction-view/search?transactionId={id}  // B√∫squeda
POST /transaction/clear                          // Limpiar pantalla</div>
                
                <span class="complexity-badge simple">Simple (2-3 pts)</span>
            </div>

            <div class="us-template">
                <strong>US-TRANS-03: Registro de nueva transacci√≥n</strong>
                <p>Como <em>operador de procesamiento</em>, quiero <em>registrar una nueva transacci√≥n con todos sus datos de comerciante, montos y fechas</em> para <em>mantener actualizado el sistema de operaciones financieras</em>.</p>
                
                <p><strong>Criterios de Aceptaci√≥n:</strong></p>
                <ul>
                    <li><strong>Identificaci√≥n (uno obligatorio):</strong> accountId (11 d√≠gitos) o cardNumber (16 d√≠gitos)</li>
                    <li><strong>Validaciones de campos obligatorios:</strong>
                        <ul>
                            <li>transactionTypeCode (1-2 d√≠gitos): "Type CD can NOT be empty...", "Type CD must be Numeric..."</li>
                            <li>transactionCategoryCode (1-4 d√≠gitos): "Category CD can NOT be empty...", "Category CD must be Numeric..."</li>
                            <li>transactionSource: "Source can NOT be empty..."</li>
                            <li>transactionDescription: "Description can NOT be empty..."</li>
                            <li>transactionAmount: validar formato -99999999.99, "Amount should be in format -99999999.99"</li>
                            <li>originalDate, processDate: "Orig Date can NOT be empty...", "Proc Date can NOT be empty..."</li>
                            <li>merchantId (num√©rico): "Merchant ID can NOT be empty...", "Merchant ID must be Numeric..."</li>
                            <li>merchantName, merchantCity, merchantZip: validaci√≥n de no vac√≠os</li>
                        </ul>
                    </li>
                    <li><strong>Flujo de confirmaci√≥n:</strong>
                        <ul>
                            <li>Primera validaci√≥n: si pasa, muestra paso de confirmaci√≥n</li>
                            <li>Campo confirmation: validar Y/N, mensaje "Invalid value. Valid values are (Y/N)..."</li>
                            <li>Si N: mensaje "Confirm to add this transaction..."</li>
                            <li>Si Y: env√≠o a backend, respuesta con transactionId generado</li>
                        </ul>
                    </li>
                    <li>F3 sale hacia /menu/main</li>
                    <li>F4 limpia el formulario completo</li>
                    <li>F5 copiar √∫ltima transacci√≥n (funcionalidad deshabilitada actualmente)</li>
                    <li>Hook: <code>useTransactionAdd</code> con validateForm, handleSubmit, handleClearForm</li>
                    <li>Conversi√≥n de datos: fechas a ISO string, amount a float para backend Spring Boot</li>
                </ul>
                
                <p><strong>Endpoints API:</strong></p>
                <div class="code-block">POST /transactions  // Registro de nueva transacci√≥n
// Request: TransactionAddRequest con campos validados
// Response: { transactionId, message, success }</div>
                
                <span class="complexity-badge complex">Complejo (5-8 pts)</span>
            </div>

            <div class="us-template">
                <strong>US-TRANS-04: Generaci√≥n de reportes mensuales</strong>
                <p>Como <em>supervisor de operaciones</em>, quiero <em>generar un reporte mensual de transacciones del mes actual</em> para <em>analizar el volumen de operaciones y totales por cuenta</em>.</p>
                
                <p><strong>Criterios de Aceptaci√≥n:</strong></p>
                <ul>
                    <li>Opci√≥n de selecci√≥n: "Monthly Report" (reporte del mes actual)</li>
                    <li>Campo de confirmaci√≥n: Y/N, validaci√≥n "Please confirm to generate the report (Y/N)..."</li>
                    <li>Si N: cancela y resetea formulario, mensaje "Report generation cancelled by user."</li>
                    <li>Si Y: genera reporte con:
                        <ul>
                            <li>Agrupaci√≥n por accountId y cardNumber</li>
                            <li>Lista de transacciones: ID, tipo, categor√≠a, descripci√≥n, source, monto</li>
                            <li>Subtotal por cuenta (accountTotal, transactionCount)</li>
                            <li>Total general (grandTotal, totalTransactionCount, accountCount)</li>
                        </ul>
                    </li>
                    <li>Visualizaci√≥n en <code>TransactionReportTable</code> con formato tabular</li>
                    <li>Bot√≥n "Download PDF" genera archivo .txt con formato legacy mainframe</li>
                    <li>Bot√≥n "Close Report" oculta la tabla de resultados</li>
                    <li>F4 limpia selecci√≥n y resetea formulario</li>
                    <li>F3 sale hacia /menu/main</li>
                    <li>Hook: <code>useTransactionReports</code> con handleReportTypeSelect, handleSubmit, handleDownloadPDF</li>
                </ul>
                
                <p><strong>Endpoints API:</strong></p>
                <div class="code-block">POST /v1/reports/transactions/monthly
// Request: { confirmed: true }
// Response: { success, message, reportData }</div>
                
                <span class="complexity-badge medium">Medio (3-5 pts)</span>
            </div>

            <div class="us-template">
                <strong>US-TRANS-05: Generaci√≥n de reportes anuales</strong>
                <p>Como <em>gerente financiero</em>, quiero <em>generar un reporte anual de transacciones del a√±o actual</em> para <em>evaluar el desempe√±o anual y tendencias de operaci√≥n</em>.</p>
                
                <p><strong>Criterios de Aceptaci√≥n:</strong></p>
                <ul>
                    <li>Opci√≥n de selecci√≥n: "Yearly Report" (reporte del a√±o en curso)</li>
                    <li>Misma estructura de confirmaci√≥n Y/N que reporte mensual</li>
                    <li>Genera reporte con misma estructura pero datos anuales</li>
                    <li>Funcionalidades de descarga y visualizaci√≥n id√©nticas a monthly</li>
                    <li>Hook: <code>useTransactionReports</code> con mutation <code>generateYearlyReport</code></li>
                </ul>
                
                <p><strong>Endpoints API:</strong></p>
                <div class="code-block">POST /v1/reports/transactions/yearly
// Request: { confirmed: true }
// Response: { success, message, reportData }</div>
                
                <span class="complexity-badge medium">Medio (3-5 pts)</span>
            </div>

            <div class="us-template">
                <strong>US-TRANS-06: Generaci√≥n de reportes personalizados por rango de fechas</strong>
                <p>Como <em>auditor</em>, quiero <em>generar un reporte de transacciones en un rango de fechas espec√≠fico</em> para <em>analizar per√≠odos particulares o investigar incidentes</em>.</p>
                
                <p><strong>Criterios de Aceptaci√≥n:</strong></p>
                <ul>
                    <li>Opci√≥n de selecci√≥n: "Custom Report" (reporte personalizado)</li>
                    <li>Campos adicionales: startDate, endDate (tipo date input)</li>
                    <li><strong>Validaciones espec√≠ficas:</strong>
                        <ul>
                            <li>"Start Date can NOT be empty..." si vac√≠o</li>
                            <li>"End Date can NOT be empty..." si vac√≠o</li>
                            <li>"Start Date cannot be after End Date..." si l√≥gica invertida</li>
                        </ul>
                    </li>
                    <li>Confirmaci√≥n Y/N antes de generar</li>
                    <li>Genera reporte con datos del rango especificado</li>
                    <li>Funcionalidades de descarga y visualizaci√≥n id√©nticas a otros reportes</li>
                    <li>Hook: <code>useTransactionReports</code> con <code>validateCustomDates</code>, <code>generateCustomReport</code></li>
                </ul>
                
                <p><strong>Endpoints API:</strong></p>
                <div class="code-block">POST /v1/reports/transactions/custom
// Request: { startDate, endDate, confirmed: true }
// Response: { success, message, reportData }</div>
                
                <span class="complexity-badge complex">Complejo (5-8 pts)</span>
            </div>

            <h3>‚ö° Factores de Aceleraci√≥n y Componentes Reutilizables</h3>
            
            <div class="component-card">
                <h4>üîÑ useTransactionList Hook</h4>
                <p><strong>Prop√≥sito:</strong> Gestiona la l√≥gica completa de listado, b√∫squeda y paginaci√≥n manual tipo mainframe.</p>
                <p><strong>Funcionalidades clave:</strong></p>
                <ul>
                    <li><code>handleSearch()</code> ‚Äì B√∫squeda inicial con validaci√≥n de Transaction ID num√©rico</li>
                    <li><code>handleNextPage()</code> ‚Äì Navega a p√°gina siguiente usando lastTransactionId del estado</li>
                    <li><code>handlePreviousPage()</code> ‚Äì Navega a p√°gina anterior usando firstTransactionId</li>
                    <li><code>handleTransactionSelect()</code> ‚Äì Valida selecci√≥n 'S' y navega a /transactions/view/:id</li>
                    <li><code>handleInitialLoad()</code> ‚Äì Carga autom√°tica del primer lote de datos</li>
                    <li>Gesti√≥n de estados: currentPage, hasNextPage, hasPreviousPage, transactions[]</li>
                </ul>
                <p><strong>Ventajas:</strong> Reutilizable en cualquier pantalla que requiera paginaci√≥n manual; validaciones integradas; navegaci√≥n autom√°tica.</p>
            </div>

            <div class="component-card">
                <h4>üîç useTransactionView Hook</h4>
                <p><strong>Prop√≥sito:</strong> Maneja b√∫squeda individual de transacci√≥n y navegaci√≥n relacionada.</p>
                <p><strong>Funcionalidades clave:</strong></p>
                <ul>
                    <li><code>handleSearch()</code> ‚Äì Consulta GET con validaci√≥n de Transaction ID no vac√≠o</li>
                    <li><code>handleClearScreen()</code> ‚Äì Llama endpoint POST /transaction/clear para resetear</li>
                    <li><code>handleBrowseTransactions()</code> ‚Äì Navega a /transactions/list</li>
                    <li><code>handleInitialLoad()</code> ‚Äì Carga autom√°tica si se recibe initialTransactionId de URL</li>
                    <li>Soporte para routing con par√°metros: useParams para extraer :transactionId</li>
                </ul>
                <p><strong>Ventajas:</strong> Integraci√≥n directa con React Router; carga lazy desde listado; validaciones backend replicadas.</p>
            </div>

            <div class="component-card">
                <h4>‚ûï useTransactionAdd Hook</h4>
                <p><strong>Prop√≥sito:</strong> Gestiona el formulario de alta de transacciones con validaciones exhaustivas y flujo de confirmaci√≥n.</p>
                <p><strong>Funcionalidades clave:</strong></p>
                <ul>
                    <li><code>validateForm()</code> ‚Äì Valida 14 campos con mensajes espec√≠ficos del backend</li>
                    <li><code>handleSubmit()</code> ‚Äì Flujo de dos pasos: validaci√≥n ‚Üí confirmaci√≥n Y/N ‚Üí env√≠o</li>
                    <li><code>handleFieldChange()</code> ‚Äì Actualiza formData y limpia errores individuales</li>
                    <li><code>handleClearForm()</code> ‚Äì Resetea todo el formulario a estado inicial</li>
                    <li>Conversi√≥n autom√°tica: fechas a ISO, amounts a float, validaci√≥n de rangos</li>
                    <li>Estado <code>isConfirmationStep</code> controla visibilidad del campo confirmation</li>
                </ul>
                <p><strong>Ventajas:</strong> Validaciones 100% alineadas con backend Spring Boot; mensajes de error exactos; conversi√≥n de tipos autom√°tica.</p>
            </div>

            <div class="component-card">
                <h4>üìä useTransactionReports Hook</h4>
                <p><strong>Prop√≥sito:</strong> Orquesta generaci√≥n de 3 tipos de reportes con validaciones espec√≠ficas por tipo.</p>
                <p><strong>Funcionalidades clave:</strong></p>
                <ul>
                    <li><code>handleReportTypeSelect()</code> ‚Äì Establece tipo: monthly | yearly | custom</li>
                    <li><code>validateCustomDates()</code> ‚Äì Validaciones espec√≠ficas para rango de fechas</li>
                    <li><code>handleSubmit()</code> ‚Äì Ruteo a mutation correcta seg√∫n reportType, validaci√≥n Y/N</li>
                    <li><code>handleDownloadPDF()</code> ‚Äì Genera archivo .txt con formato mainframe legacy</li>
                    <li><code>handleCloseReport()</code> ‚Äì Oculta tabla de resultados sin perder datos</li>
                    <li>Tres mutations independientes: <code>generateMonthlyReport</code>, <code>generateYearlyReport</code>, <code>generateCustomReport</code></li>
                </ul>
                <p><strong>Ventajas:</strong> Arquitectura escalable para nuevos tipos de reporte; descarga en formato legacy para compatibilidad; manejo de reportData complejo.</p>
            </div>

            <div class="component-card">
                <h4>üìã TransactionReportTable Component</h4>
                <p><strong>Prop√≥sito:</strong> Componente visual especializado para mostrar reportes con agrupaci√≥n por cuenta.</p>
                <p><strong>Caracter√≠sticas:</strong></p>
                <ul>
                    <li>Agrupaci√≥n visual por accountGroups (cardNumber + accountId)</li>
                    <li>Formato de montos en USD currency con Intl.NumberFormat</li>
                    <li>Subtotales por cuenta con accountTotal y transactionCount</li>
                    <li>Total general con grandTotal, totalTransactionCount, accountCount</li>
                    <li>Dise√±o responsive con scroll horizontal para tablas anchas</li>
                </ul>
                <p><strong>Ventajas:</strong> Reutilizable para cualquier tipo de reporte (monthly/yearly/custom); formato profesional; totales autom√°ticos.</p>
            </div>

            <h3>üóÇÔ∏è Estructura de Datos y Contratos de API</h3>

            <h4>TransactionListRequest / Response</h4>
            <div class="code-block">// Request
interface TransactionListRequest {
  transactionId?: string;      // Opcional para b√∫squeda filtrada
  pageNumber?: number;          // N√∫mero de p√°gina
  selectionFlag?: string;       // 'S' para selecci√≥n
  selectedTransactionId?: string;
}

// Response
interface TransactionListResponse {
  transactions: TransactionItem[];
  currentPage: number;
  hasNextPage: boolean;
  hasPreviousPage: boolean;
  firstTransactionId?: string;  // Para paginaci√≥n anterior
  lastTransactionId?: string;   // Para paginaci√≥n siguiente
  message?: string;
  errorMessage?: string;
}

interface TransactionItem {
  transactionId: string;
  date: string;                 // MM/DD/YY
  description: string;
  amount: number;
}</div>

            <h4>TransactionViewRequest / Response</h4>
            <div class="code-block">// Request
interface TransactionViewRequest {
  transactionId: string;
}

// Response
interface TransactionViewResponse {
  transactionId?: string;
  cardNumber?: string;
  transactionTypeCode?: string;
  transactionCategoryCode?: string;
  transactionSource?: string;
  transactionAmount?: string;        // BigDecimal como string
  transactionDescription?: string;
  originalTimestamp?: string;        // ISO string
  processedTimestamp?: string;       // ISO string
  merchantId?: string;
  merchantName?: string;
  merchantCity?: string;
  merchantZip?: string;
  
  // Header info
  currentDate?: string;              // MM/dd/yy
  currentTime?: string;              // HH:mm:ss
  programName?: string;              // "COTRN01C"
  transactionName?: string;          // "CT01"
  
  errorMessage?: string;
}</div>

            <h4>TransactionAddRequest / Response</h4>
            <div class="code-block">// Request
interface TransactionAddRequest {
  // Identificaci√≥n (uno obligatorio)
  accountId?: string;               // 11 d√≠gitos
  cardNumber?: string;              // 16 d√≠gitos
  
  // Datos de transacci√≥n
  transactionTypeCode: string;      // 1-2 d√≠gitos
  transactionCategoryCode: string;  // 1-4 d√≠gitos
  transactionSource: string;
  transactionDescription: string;
  transactionAmount: string;        // -99999999.99 a 99999999.99
  originalDate: string;             // Convertido a ISO
  processDate: string;              // Convertido a ISO
  
  // Comerciante
  merchantId: string;               // Num√©rico
  merchantName: string;
  merchantCity: string;
  merchantZip: string;
  
  // Confirmaci√≥n
  confirmation: 'Y' | 'N' | '';
}

// Response
interface TransactionAddResponse {
  transactionId: string | null;     // ID generado por backend
  message: string;
  success: boolean;
}</div>

            <h4>TransactionReportRequest / Response</h4>
            <div class="code-block">// Request
interface TransactionReportRequest {
  startDate?: string;               // Solo para custom
  endDate?: string;                 // Solo para custom
  confirmed: boolean;               // true para Y
}

// Response
interface TransactionReportResponse {
  success: boolean;
  message: string;
  reportType?: string;              // 'monthly' | 'yearly' | 'custom'
  jobId?: string;
  timestamp?: string;
  reportData?: ReportData;
}

interface ReportData {
  reportType: string;
  startDate: string;
  endDate: string;
  accountGroups: AccountGroup[];
  grandTotal: number;
  totalTransactionCount: number;
  accountCount: number;
}

interface AccountGroup {
  cardNumber: string;
  accountId: number;
  transactions: Transaction[];
  accountTotal: number;
  transactionCount: number;
}</div>

            <h3>üîë Teclas de Funci√≥n (Function Keys)</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>Tecla</th>
                        <th>Pantalla</th>
                        <th>Acci√≥n</th>
                        <th>Equivalente COBOL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>F3</strong></td>
                        <td>Todas</td>
                        <td>Salir a /menu/main</td>
                        <td>EXIT / RETURN</td>
                    </tr>
                    <tr>
                        <td><strong>F4</strong></td>
                        <td>Add, Reports, View</td>
                        <td>Limpiar formulario / Clear Screen</td>
                        <td>CLEAR</td>
                    </tr>
                    <tr>
                        <td><strong>F5</strong></td>
                        <td>Add</td>
                        <td>Copiar √∫ltima transacci√≥n (deshabilitado)</td>
                        <td>COPY-LAST</td>
                    </tr>
                    <tr>
                        <td><strong>F7</strong></td>
                        <td>List</td>
                        <td>P√°gina anterior</td>
                        <td>PAGE-UP</td>
                    </tr>
                    <tr>
                        <td><strong>F8</strong></td>
                        <td>List, View</td>
                        <td>P√°gina siguiente / Browse Transactions</td>
                        <td>PAGE-DOWN / BROWSE</td>
                    </tr>
                    <tr>
                        <td><strong>F12</strong></td>
                        <td>Add</td>
                        <td>Salir del m√≥dulo</td>
                        <td>CANCEL</td>
                    </tr>
                    <tr>
                        <td><strong>ENTER</strong></td>
                        <td>Todas</td>
                        <td>Confirmar acci√≥n / Buscar / Seleccionar</td>
                        <td>ENTER</td>
                    </tr>
                    <tr>
                        <td><strong>ESC</strong></td>
                        <td>Todas</td>
                        <td>Cancelar / Salir</td>
                        <td>ESC / CANCEL</td>
                    </tr>
                </tbody>
            </table>

            <h3>‚úÖ Patrones de Validaci√≥n</h3>
            
            <div class="highlight">
                <strong>‚ö†Ô∏è Importante:</strong> Todas las validaciones frontend deben replicar exactamente las validaciones del backend Spring Boot para mantener consistencia y evitar errores de sincronizaci√≥n.
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Validaci√≥n</th>
                        <th>Mensaje de Error</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>transactionId (b√∫squeda)</td>
                        <td>Solo d√≠gitos</td>
                        <td>"Tran ID must be Numeric ..."</td>
                    </tr>
                    <tr>
                        <td>transactionId (view)</td>
                        <td>No vac√≠o</td>
                        <td>"Transaction ID cannot be empty..."</td>
                    </tr>
                    <tr>
                        <td>accountId</td>
                        <td>/^\d{1,11}$/</td>
                        <td>"Account ID must be Numeric..."</td>
                    </tr>
                    <tr>
                        <td>cardNumber</td>
                        <td>/^\d{1,16}$/</td>
                        <td>"Card Number must be Numeric..."</td>
                    </tr>
                    <tr>
                        <td>transactionTypeCode</td>
                        <td>/^\d{1,2}$/, no vac√≠o</td>
                        <td>"Type CD can NOT be empty..." / "Type CD must be Numeric..."</td>
                    </tr>
                    <tr>
                        <td>transactionCategoryCode</td>
                        <td>/^\d{1,4}$/, no vac√≠o</td>
                        <td>"Category CD can NOT be empty..." / "Category CD must be Numeric..."</td>
                    </tr>
                    <tr>
                        <td>transactionAmount</td>
                        <td>-99999999.99 a 99999999.99</td>
                        <td>"Amount should be in format -99999999.99"</td>
                    </tr>
                    <tr>
                        <td>merchantId</td>
                        <td>/^\d+$/, no vac√≠o</td>
                        <td>"Merchant ID can NOT be empty..." / "Merchant ID must be Numeric..."</td>
                    </tr>
                    <tr>
                        <td>confirmation</td>
                        <td>/^[YyNn]$/</td>
                        <td>"Invalid value. Valid values are (Y/N)..."</td>
                    </tr>
                    <tr>
                        <td>startDate / endDate</td>
                        <td>No vac√≠o, startDate ‚â§ endDate</td>
                        <td>"Start Date can NOT be empty..." / "Start Date cannot be after End Date..."</td>
                    </tr>
                </tbody>
            </table>

            <h3>üîê Reglas de Negocio Cr√≠ticas</h3>
            
            <div class="highlight">
                <h4>Alta de Transacciones</h4>
                <ul>
                    <li>Se requiere <strong>accountId O cardNumber</strong> (al menos uno)</li>
                    <li>Si ambos est√°n presentes, se validan ambos</li>
                    <li>Montos negativos permitidos (devoluciones/reembolsos)</li>
                    <li>Fechas se env√≠an como ISO string a backend para conversi√≥n a LocalDateTime</li>
                    <li>Confirmaci√≥n obligatoria en dos pasos para prevenir errores</li>
                </ul>
            </div>

            <div class="highlight">
                <h4>Paginaci√≥n Manual</h4>
                <ul>
                    <li>Usa <code>firstTransactionId</code> y <code>lastTransactionId</code> para navegaci√≥n</li>
                    <li>No se basa en offsets num√©ricos (patr√≥n legacy COBOL)</li>
                    <li>Backend controla hasNextPage y hasPreviousPage basado en cantidad de resultados</li>
                    <li>Mensajes espec√≠ficos cuando se alcanza l√≠mite superior o inferior</li>
                </ul>
            </div>

            <div class="highlight">
                <h4>Reportes</h4>
                <ul>
                    <li>Reportes monthly/yearly usan fecha actual del sistema</li>
                    <li>Custom permite rango arbitrario con validaci√≥n de l√≥gica de fechas</li>
                    <li>Agrupaci√≥n por cuenta (cardNumber + accountId) es autom√°tica en backend</li>
                    <li>Formato de descarga replica formato mainframe legacy (espaciado fijo)</li>
                    <li>Confirmaci√≥n Y/N obligatoria antes de generaci√≥n</li>
                </ul>
            </div>

            <h3>üì° Endpoints del Backend</h3>
            
            <div class="api-endpoint">
                <strong>POST /transactions/list</strong><br>
                Request: { transactionId?, pageNumber? }<br>
                Response: { transactions[], currentPage, hasNextPage, hasPreviousPage, firstTransactionId?, lastTransactionId? }
            </div>

            <div class="api-endpoint">
                <strong>POST /transactions/next-page</strong><br>
                Request: { transactionId (lastTransactionId), pageNumber }<br>
                Response: Misma estructura que /list
            </div>

            <div class="api-endpoint">
                <strong>POST /transactions/previous-page</strong><br>
                Request: { transactionId (firstTransactionId), pageNumber }<br>
                Response: Misma estructura que /list
            </div>

            <div class="api-endpoint">
                <strong>GET /transaction-view/search?transactionId={id}</strong><br>
                Response: { transactionId, cardNumber, typeCode, categoryCode, amount, merchantId, merchantName, ... }
            </div>

            <div class="api-endpoint">
                <strong>POST /transaction/clear</strong><br>
                Response: TransactionViewResponse con valores de header (currentDate, currentTime, programName)
            </div>

            <div class="api-endpoint">
                <strong>POST /transactions</strong><br>
                Request: TransactionAddRequest completo<br>
                Response: { transactionId, message, success }
            </div>

            <div class="api-endpoint">
                <strong>POST /v1/reports/transactions/monthly</strong><br>
                Request: { confirmed: true }<br>
                Response: { success, message, reportData? }
            </div>

            <div class="api-endpoint">
                <strong>POST /v1/reports/transactions/yearly</strong><br>
                Request: { confirmed: true }<br>
                Response: { success, message, reportData? }
            </div>

            <div class="api-endpoint">
                <strong>POST /v1/reports/transactions/custom</strong><br>
                Request: { startDate, endDate, confirmed: true }<br>
                Response: { success, message, reportData? }
            </div>

            <h3>üß™ Estrategia de Testing</h3>
            
            <div class="component-card">
                <h4>Testing con MSW (Mock Service Worker)</h4>
                <p>El m√≥dulo incluye mocks completos que permiten desarrollo y testing sin backend:</p>
                <ul>
                    <li><strong>Activaci√≥n:</strong> Variable de entorno <code>VITE_USE_MOCKS=true</code></li>
                    <li><strong>Cobertura:</strong> Todos los endpoints (list, view, add, reports) tienen handlers MSW</li>
                    <li><strong>Validaciones:</strong> Mocks replican validaciones del backend (mensajes de error, formatos)</li>
                    <li><strong>Datos sint√©ticos:</strong> Generaci√≥n autom√°tica de transacciones, cuentas y reportes realistas</li>
                </ul>
                <p><strong>Ventaja:</strong> Desarrollo frontend independiente, testing de flujos end-to-end sin API real.</p>
            </div>

            <h3>üí° Consejos para Desarrollo de User Stories</h3>
            
            <div class="highlight">
                <ul>
                    <li><strong>Reutilizar hooks:</strong> No crear l√≥gica duplicada; los 4 hooks cubren todos los casos de uso</li>
                    <li><strong>Validaciones exhaustivas:</strong> Siempre incluir mensajes espec√≠ficos en criterios de aceptaci√≥n</li>
                    <li><strong>Testing con mocks:</strong> Validar flujos con <code>VITE_USE_MOCKS=true</code> antes de integraci√≥n con backend</li>
                    <li><strong>Navegaci√≥n consistente:</strong> Usar siempre <code>navigate()</code> de React Router, nunca window.location</li>
                    <li><strong>Manejo de errores:</strong> Propagar errores a p√°ginas para mostrar en Snackbar/Alert de Material-UI</li>
                    <li><strong>Formato de fechas:</strong> Backend usa LocalDateTime (ISO strings), frontend muestra MM/DD/YY</li>
                    <li><strong>Montos:</strong> Backend usa BigDecimal, frontend recibe strings, validar rangos antes de env</li>
                    <li><strong>Confirmaciones:</strong> Siempre implementar paso de confirmaci√≥n Y/N para operaciones cr√≠ticas (add, reports)</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>üìö Referencias y Recursos</h2>
            <ul style="list-style: disc; margin-left: 2rem;">
                <li><strong>Repositorio:</strong> <code>/app/components/transaction/</code>, <code>/app/hooks/</code>, <code>/app/types/</code>, <code>/app/mocks/</code></li>
                <li><strong>Documentaci√≥n de sistema:</strong> <code>/docs/system-overview.md</code></li>
                <li><strong>Mocks de desarrollo:</strong> <code>MOCK_DATA_SUMMARY.md</code>, <code>MOCK_DATA_QUICK_REF.md</code></li>
                <li><strong>Validaci√≥n de mocks:</strong> <code>./validate-mocks.sh</code></li>
                <li><strong>Tecnolog√≠as:</strong> React 18, TypeScript, React Router 6, Material-UI 5, MSW (Mock Service Worker)</li>
            </ul>
        </section>

        <footer style="text-align: center; margin-top: 3rem; padding: 2rem;">
            <a href="../index.html" class="back-link">‚Üê Volver al √çndice de M√≥dulos</a>
            <p style="margin-top: 1rem; color: #64748b;">Documentaci√≥n generada para DSD-13 | M√≥dulo TRANSACTION - Transacciones</p>
        </footer>
    </div>
</body>
</html>
